# å›¾ç‰‡æ°´å°å»é™¤å·¥å…·ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

`removeWatermark.cjs` æ˜¯ä¸€ä¸ªç”¨äºå»é™¤å›¾ç‰‡é¡¶éƒ¨æ°´å°çš„è„šæœ¬å·¥å…·ã€‚ä¸»è¦ç”¨äºå¤„ç† `generateEventImages.cjs` ç”Ÿæˆçš„å¸¦æœ‰æ°´å°çš„å›¾ç‰‡ã€‚

## å®‰è£…ä¾èµ–

é¦–å…ˆéœ€è¦å®‰è£… sharp ä¾èµ–ï¼š

```bash
npm install sharp
```

Sharp æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„å›¾åƒå¤„ç†åº“ï¼Œæ¯” canvas æ›´è½»é‡ä¸”å®‰è£…æ›´ç®€å•ã€‚

å¦‚æœé‡åˆ°å®‰è£…é—®é¢˜ï¼Œå¯ä»¥å°è¯•ï¼š

```bash
# æ¸…ç†ç¼“å­˜åé‡æ–°å®‰è£…
npm cache clean --force
npm install sharp

# æˆ–è€…ä½¿ç”¨ yarn
yarn add sharp
```

## ä½¿ç”¨æ–¹æ³•

### åŸºæœ¬ç”¨æ³•

```bash
# å¤„ç†é»˜è®¤ç›®å½• (public/assets/events) ä¸­çš„æ‰€æœ‰å›¾ç‰‡
node scripts/removeWatermark.cjs

# å¤„ç†å•ä¸ªæ–‡ä»¶
node scripts/removeWatermark.cjs --file public/assets/events/å›¾ç‰‡åç§°.png

# è‡ªå®šä¹‰è£å‰ªé«˜åº¦ï¼ˆé»˜è®¤50åƒç´ ï¼‰
node scripts/removeWatermark.cjs --crop 60

# ä¿å­˜ä¸ºæ–°æ–‡ä»¶è€Œä¸è¦†ç›–åŸæ–‡ä»¶
node scripts/removeWatermark.cjs --suffix "_no_watermark"
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `--dir <ç›®å½•>` | æŒ‡å®šè¦å¤„ç†çš„å›¾ç‰‡ç›®å½• | `public/assets/events` |
| `--file <æ–‡ä»¶>` | å¤„ç†å•ä¸ªæ–‡ä»¶ | æ—  |
| `--crop <åƒç´ >` | è¦è£å‰ªçš„é¡¶éƒ¨åƒç´ æ•° | `50` |
| `--suffix <åç¼€>` | è¾“å‡ºæ–‡ä»¶åç¼€ï¼Œä¸æŒ‡å®šåˆ™è¦†ç›–åŸæ–‡ä»¶ | æ—  |
| `--rename-original` | é…åˆ--suffixä½¿ç”¨ï¼Œå°†åŸæ–‡ä»¶æ”¹åï¼Œæ–°æ–‡ä»¶ä½¿ç”¨åŸå | æ—  |
| `--help` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ | æ—  |

### ä½¿ç”¨ç¤ºä¾‹

#### 1. å¤„ç†æ‰€æœ‰äº‹ä»¶å›¾ç‰‡
```bash
node scripts/removeWatermark.cjs
```

#### 2. å¤„ç†å•ä¸ªå›¾ç‰‡æ–‡ä»¶
```bash
node scripts/removeWatermark.cjs --file public/assets/events/éšæœºè®­ç»ƒ.png
```

#### 3. è‡ªå®šä¹‰è£å‰ªé«˜åº¦
```bash
# å¦‚æœæ°´å°åŒºåŸŸæ˜¯60åƒç´ é«˜
node scripts/removeWatermark.cjs --crop 60
```

#### 4. ä¿å­˜ä¸ºæ–°æ–‡ä»¶
```bash
# åŸæ–‡ä»¶ï¼šéšæœºè®­ç»ƒ.png
# æ–°æ–‡ä»¶ï¼šéšæœºè®­ç»ƒ_clean.png
node scripts/removeWatermark.cjs --suffix "_clean"
```

#### 5. é‡å‘½ååŸæ–‡ä»¶æ¨¡å¼
```bash
# åŸæ–‡ä»¶ï¼šéšæœºè®­ç»ƒ.png â†’ éšæœºè®­ç»ƒ_original.png
# æ–°æ–‡ä»¶ï¼šéšæœºè®­ç»ƒ.pngï¼ˆå¤„ç†åçš„å›¾ç‰‡ï¼‰
node scripts/removeWatermark.cjs --suffix "_original" --rename-original
```

#### 6. å¤„ç†å…¶ä»–ç›®å½•çš„å›¾ç‰‡
```bash
node scripts/removeWatermark.cjs --dir /path/to/other/images
```

## æ”¯æŒçš„å›¾ç‰‡æ ¼å¼

- PNG (.png)
- JPEG (.jpg, .jpeg)
- WebP (.webp)

## å·¥ä½œæµç¨‹

1. **æ‰«ææ–‡ä»¶**ï¼šæ‰«ææŒ‡å®šç›®å½•æˆ–å•ä¸ªæ–‡ä»¶
2. **åŠ è½½å›¾ç‰‡**ï¼šä½¿ç”¨ canvas åŠ è½½åŸå§‹å›¾ç‰‡
3. **è£å‰ªå¤„ç†**ï¼šå»æ‰é¡¶éƒ¨æŒ‡å®šåƒç´ æ•°çš„åŒºåŸŸ
4. **ä¿å­˜ç»“æœ**ï¼šä¿å­˜å¤„ç†åçš„å›¾ç‰‡

## è¾“å‡ºç¤ºä¾‹

```
ğŸ¨ å›¾ç‰‡æ°´å°å»é™¤å·¥å…·
âœ‚ï¸  è£å‰ªé¡¶éƒ¨: 50 åƒç´ 
ğŸ“ å¤„ç†ç›®å½•: /path/to/public/assets/events

ğŸ“ æ‰¾åˆ° 3 ä¸ªå›¾ç‰‡æ–‡ä»¶

ğŸ–¼ï¸  å¤„ç†å›¾ç‰‡: éšæœºè®­ç»ƒ.png
   ğŸ“ åŸå§‹å°ºå¯¸: 1024x1024
   âœ‚ï¸  è£å‰ªé¡¶éƒ¨: 50px
   ğŸ“ æ–°å°ºå¯¸: 1024x974
   âœ… ä¿å­˜åˆ°: éšæœºè®­ç»ƒ.png

ğŸ–¼ï¸  å¤„ç†å›¾ç‰‡: ç¥ç§˜å®ç®±.png
   ğŸ“ åŸå§‹å°ºå¯¸: 1024x1024
   âœ‚ï¸  è£å‰ªé¡¶éƒ¨: 50px
   ğŸ“ æ–°å°ºå¯¸: 1024x974
   âœ… ä¿å­˜åˆ°: ç¥ç§˜å®ç®±.png

ğŸ“Š å¤„ç†ç»“æœç»Ÿè®¡:
   âœ… æˆåŠŸ: 3 ä¸ªæ–‡ä»¶
   âŒ å¤±è´¥: 0 ä¸ªæ–‡ä»¶

ğŸ‰ æ€»å…±è£å‰ªäº† 150 åƒç´ çš„æ°´å°åŒºåŸŸ
```

## æ³¨æ„äº‹é¡¹

1. **å¤‡ä»½é‡è¦æ–‡ä»¶**ï¼šå¦‚æœä¸ä½¿ç”¨ `--suffix` å‚æ•°ï¼Œè„šæœ¬ä¼šè¦†ç›–åŸæ–‡ä»¶
2. **æ£€æŸ¥è£å‰ªé«˜åº¦**ï¼šç¡®ä¿è£å‰ªé«˜åº¦ä¸ä¼šè¶…è¿‡å›¾ç‰‡æœ¬èº«çš„é«˜åº¦
3. **å›¾ç‰‡è´¨é‡**ï¼šå¤„ç†åçš„å›¾ç‰‡ä¼šä¿å­˜ä¸º PNG æ ¼å¼ä»¥ä¿æŒè´¨é‡
4. **ä¾èµ–è¦æ±‚**ï¼šéœ€è¦å®‰è£… canvas ä¾èµ–ï¼Œå¯èƒ½éœ€è¦ç³»ç»Ÿçº§çš„å›¾å½¢åº“æ”¯æŒ

## é”™è¯¯å¤„ç†

è„šæœ¬ä¼šè‡ªåŠ¨å¤„ç†ä»¥ä¸‹é”™è¯¯æƒ…å†µï¼š
- æ–‡ä»¶ä¸å­˜åœ¨
- ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼
- è£å‰ªé«˜åº¦è¿‡å¤§
- æƒé™é—®é¢˜
- å†…å­˜ä¸è¶³

## ä¸å›¾ç‰‡ç”Ÿæˆè„šæœ¬çš„é…åˆä½¿ç”¨

æ¨èçš„å·¥ä½œæµç¨‹ï¼š

1. ä½¿ç”¨ `generateEventImages.cjs` ç”Ÿæˆäº‹ä»¶å›¾ç‰‡
2. ä½¿ç”¨ `removeWatermark.cjs` å»é™¤æ°´å°
3. å›¾ç‰‡è‡ªåŠ¨æ›´æ–°åˆ°æ¸¸æˆä¸­

```bash
# 1. ç”Ÿæˆå›¾ç‰‡
IMAGE_API_TOKEN=your_token node scripts/generateEventImages.cjs --event "éšæœºè®­ç»ƒ" --file "src/eventSystem/events/randomEvents.ts"

# 2. å»é™¤æ°´å°
node scripts/removeWatermark.cjs --file public/assets/events/éšæœºè®­ç»ƒ.png
```